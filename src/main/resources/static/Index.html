<!DOCTYPE html>
<html>
<head>
    <title>Live Logs</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2/dist/stomp.min.js"></script>
</head>
<body>

<h2>Live Server Logs</h2>

<div id="logArea" style="border:1px solid #aaa; padding:10px; height:300px; overflow-y:auto;"></div>

<script>
    let socket = new SockJS('/ws');
    let stompClient = Stomp.over(socket);

    // Add connection status element
    const statusDiv = document.createElement('div');
    statusDiv.id = 'connectionStatus';
    statusDiv.style.marginBottom = '10px';
    statusDiv.innerHTML = 'Status: <b>Connecting...</b>';
    document.body.insertBefore(statusDiv, document.getElementById('logArea').previousElementSibling);

    stompClient.connect({}, function (frame) {
        document.getElementById('connectionStatus').innerHTML = 'Status: <b style="color:green">Connected</b>';
        console.log('Connected: ' + frame);
        
        stompClient.subscribe('/topic/logs', function (message) {
            let log = JSON.parse(message.body);
            let logArea = document.getElementById("logArea");
            logArea.innerHTML += `<div><b>${log.timestamp}</b>: ${log.text}</div>`;
            logArea.scrollTop = logArea.scrollHeight; // Auto-scroll to bottom
        });
    }, function(error) {
        document.getElementById('connectionStatus').innerHTML = 'Status: <b style="color:red">Disconnected</b> - ' + error;
        console.error('STOMP error:', error);
        document.getElementById("logArea").innerHTML += `<div style="color:red"><b>Error:</b> Could not connect to WebSocket server.</div>`;
    });
</script>

</body>
</html>
